{"version":3,"file":"component---src-pages-docs-client-retry-mdx-c6216cceed07a1447928.js","mappings":"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","sources":["webpack://armeria-site/./src/pages/docs/client-retry.mdx","webpack://armeria-site/./src/layouts/docs.tsx"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport DefaultLayout from \"/home/runner/work/armeria/armeria/site/src/layouts/docs.tsx\";\nexport const pageTitle = \"Automatic retry\";\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\nconst Warning = makeShortcode(\"Warning\");\nconst Tip = makeShortcode(\"Tip\");\nconst layoutProps = {\n  pageTitle,\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <h1 {...{\n      \"id\": \"automatic-retry\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#automatic-retry\",\n        \"aria-label\": \"automatic retry permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Automatic retry`}</h1>\n    <h6 {...{\n      \"className\": \"inlinePageToc\",\n      \"role\": \"navigation\"\n    }}>{`Table of contents`}</h6>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#retryingclient\"\n        }}>{`RetryingClient`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#retryrule\"\n        }}>{`RetryRule`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#backoff\"\n        }}>{`Backoff`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#maxtotalattempts-vs-per-backoff-maxattempts\"\n        }}>{`maxTotalAttempts vs per-Backoff maxAttempts`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#per-attempt-timeout\"\n        }}>{`Per-attempt timeout`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#retryingclient-with-logging\"\n        }}>{`RetryingClient with logging`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#retryingclient-with-circuit-breaker\"\n        }}>{`RetryingClient with circuit breaker`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#see-also\"\n        }}>{`See also`}</a></li>\n    </ul>\n    <p>{`When a client gets an error response, it might want to retry the request depending on the response.\nThis can be accomplished using a `}<a parentName=\"p\" {...{\n        \"href\": \"/docs/client-decorator\"\n      }}>{`decorator`}</a>{`, and Armeria provides the following\nimplementations out-of-the box.`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n        }}>{`type://RetryingClient`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"type://RetryingRpcClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingRpcClient.html\"\n        }}>{`type://RetryingRpcClient`}</a></li>\n    </ul>\n    <p>{`Both behave the same except for the different request and response types.\nSo, let's find out what we can do with `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{`.`}</p>\n    <h2 {...{\n      \"id\": \"retryingclient\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#retryingclient\",\n        \"aria-label\": \"retryingclient permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><inlineCode parentName=\"h2\">{`RetryingClient`}</inlineCode></h2>\n    <p>{`You can just use the `}<inlineCode parentName=\"p\">{`decorator()`}</inlineCode>{` method in `}<a parentName=\"p\" {...{\n        \"href\": \"type://ClientBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ClientBuilder.html\"\n      }}>{`type://ClientBuilder`}</a>{` or `}<a parentName=\"p\" {...{\n        \"href\": \"type://WebClientBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClientBuilder.html\"\n      }}>{`type://WebClientBuilder`}</a>{` to build a\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{`. For example:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.WebClient;\nimport com.linecorp.armeria.client.retry.RetryingClient;\nimport com.linecorp.armeria.client.retry.RetryRule;\nimport com.linecorp.armeria.common.AggregatedHttpResponse;\n\nRetryRule rule = RetryRule.failsafe();\nWebClient client = WebClient.builder(\"http://example.com/hello\")\n                            .decorator(RetryingClient.newDecorator(rule))\n                            .build();\n\nAggregatedHttpResponse res = client.execute(...).aggregate().join();\n`}</code></pre>\n    <p>{`That's it. The client will keep attempting until it succeeds or the number of attempts exceeds the maximum\nnumber of total attempts. You can configure the `}<inlineCode parentName=\"p\">{`maxTotalAttempts`}</inlineCode>{` when making the decorator using\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient#newDecorator(RetryRule,int):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html#newDecorator(com.linecorp.armeria.client.retry.RetryRule,int)\"\n      }}>{`type://RetryingClient#newDecorator(RetryRule,int)`}</a>{`. Meanwhile, the `}<inlineCode parentName=\"p\">{`rule`}</inlineCode>{` will decide to\nretry depending on the response. In this case, the client retries when it receives `}<inlineCode parentName=\"p\">{`5xx`}</inlineCode>{` response error or\nan exception is raised.`}</p>\n    <h2 {...{\n      \"id\": \"retryrule\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#retryrule\",\n        \"aria-label\": \"retryrule permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><inlineCode parentName=\"h2\">{`RetryRule`}</inlineCode></h2>\n    <p>{`You can fluently build your own `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryRule:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryRule.html\"\n      }}>{`type://RetryRule`}</a>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.ResponseTimeoutException;\nimport com.linecorp.armeria.common.HttpStatus;\n\nBackoff myBackoff = ...;\nRetryRule.of(RetryRule.builder().onUnProcessed().thenBackoff(myBackoff),\n             RetryRule.builder().onException(ResponseTimeoutException.class).thenBackoff(),\n             RetryRule.builder().onStatus(HttpStatus.TOO_MANY_REQUESTS).thenNoRetry())\n`}</code></pre>\n    <p>{`Or you can customize the `}<strong parentName=\"p\">{`rule`}</strong>{` by implementing `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryRule:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryRule.html\"\n      }}>{`type://RetryRule`}</a>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.ClientRequestContext;\nimport com.linecorp.armeria.client.UnprocessedRequestException;\nimport com.linecorp.armeria.client.retry.Backoff;\nimport com.linecorp.armeria.client.retry.RetryDecision;\nimport com.linecorp.armeria.common.ResponseHeaders;\nimport com.linecorp.armeria.common.logging.RequestLogProperty;\n\nnew RetryRule() {\n    Backoff backoff = Backoff.ofDefault();\n\n    @Override\n    public CompletionStage<RetryDecision> shouldRetry(ClientRequestContext ctx,\n                                                      @Nullable Throwable cause) {\n        if (cause != null) {\n            if (cause instanceof ResponseTimeoutException ||\n                cause instanceof UnprocessedRequestException) {\n                // The response timed out or the request has not been handled\n                // by the server.\n                return UnmodifiableFuture.completedFuture(RetryDecision.retry(backoff));\n            }\n        }\n\n        ResponseHeaders responseHeaders = ctx.log().ensureAvailable(RequestLogProperty.RESPONSE_HEADERS)\n                                             .responseHeaders();\n        if (responseHeaders.status() == HttpStatus.TOO_MANY_REQUESTS) {\n            return UnmodifiableFuture.completedFuture(RetryDecision.stop());\n        }\n\n        // Return 'next()' to lookup other rules.\n        return UnmodifiableFuture.completedFuture(RetryDecision.next());\n    }\n};\n`}</code></pre>\n    <p>{`This will retry when one of `}<a parentName=\"p\" {...{\n        \"href\": \"type://ResponseTimeoutException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ResponseTimeoutException.html\"\n      }}>{`type://ResponseTimeoutException`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"type://UnprocessedRequestException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/UnprocessedRequestException.html\"\n      }}>{`type://UnprocessedRequestException`}</a>{` is raised.\nHowever, if the response's status is `}<inlineCode parentName=\"p\">{`429 Too Many Requests`}</inlineCode>{`, it will stop retrying.\nFor all other cases, it will defer to the next rule if one exists.`}</p>\n    <Warning mdxType=\"Warning\">\n      <p>{`We declare a `}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` as a member and reuse it when a `}<inlineCode parentName=\"p\">{`rule`}</inlineCode>{` returns it, so that we do not\nreturn a different `}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` instance for each `}<inlineCode parentName=\"p\">{`shouldRetry()`}</inlineCode>{`. `}<a parentName=\"p\" {...{\n          \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n        }}>{`type://RetryingClient`}</a>{`\ninternally tracks the reference of the returned `}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` and increases the counter that keeps\nthe number of attempts made so far, and resets it to 0 when the `}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` returned by the retry rule\nis not the same as before. Therefore, it is important to return the same `}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` instance unless\nyou decided to change your `}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` strategy. If you do not return the same one, when the\n`}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` yields a different delay based on the number of retries, such as an exponential backoff,\nit will not work as expected. We will take a close look into a `}<a parentName=\"p\" {...{\n          \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n        }}>{`type://Backoff`}</a>{` at the next section.`}</p>\n    </Warning>\n    <Tip mdxType=\"Tip\">\n      <p><a parentName=\"p\" {...{\n          \"href\": \"type://UnprocessedRequestException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/UnprocessedRequestException.html\"\n        }}>{`type://UnprocessedRequestException`}</a>{` literally means that the request has not been processed by the server.\nTherefore, you can safely retry the request without worrying about the idempotency of the request.\nFor more information about idempotency, please refer to\n`}<a parentName=\"p\" {...{\n          \"href\": \"http://restcookbook.com/HTTP%20Methods/idempotency/\"\n        }}>{`What are idempotent and/or safe methods?`}</a>{`.`}</p>\n    </Tip>\n    <p>{`You can return a different `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` according to the response status.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.common.HttpStatusClass;\n\nBackoff backoffOnServerErrorOrTimeout = Backoff.ofDefault();\nBackoff backoffOnConflict = Backoff.fixed(100);\nRetryRule.builder()\n         .onException(ex -> ex instanceof ResponseTimeoutException ||\n                            ex instanceof UnprocessedRequestException)\n         .thenBackoff(backoffOnServerErrorOrTimeout)\n         .orElse(RetryRule.builder()\n                          .onStatusClass(HttpStatusClass.SERVER_ERROR)\n                          .thenBackoff(backoffOnServerErrorOrTimeout))\n         .orElse(RetryRule.builder()\n                          .onStatus(HttpStatus.CONFLICT)\n                          .thenBackoff(backoffOnConflict));\n`}</code></pre>\n    <p>{`If you need to determine whether you need to retry by looking into the response content, you should implement\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryRuleWithContent:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryRuleWithContent.html\"\n      }}>{`type://RetryRuleWithContent`}</a>{` and specify it when you create a `}<a parentName=\"p\" {...{\n        \"href\": \"type://WebClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/WebClient.html\"\n      }}>{`type://WebClient`}</a>{`\nusing `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClientBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClientBuilder.html\"\n      }}>{`type://RetryingClientBuilder`}</a>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.retry.RetryRuleWithContent;\n\nRetryRuleWithContent<HttpResponse> retryRule =\n        RetryRuleWithContent\n                .<HttpResponse>builder()\n                .onException(ex -> ex instanceof ResponseTimeoutException ||\n                                   ex instanceof UnprocessedRequestException)\n                .onResponse(response -> {\n                    return response.aggregate()\n                                   .thenApply(content -> \"Should I retry?\".equals(content.contentUtf8()));\n                })\n                .thenBackoff(backoff);\n\n// Create a WebClient with a retry rule.\nWebClient client = WebClient\n        .builder(...)\n        .decorator(RetryingClient.builder(retryRule)\n                                 .newDecorator())\n        .build();\n\nAggregatedHttpResponse res = client.execute(...).aggregate().join();\n`}</code></pre>\n    <Tip mdxType=\"Tip\">\n      <p>{`You might find the `}<a parentName=\"p\" {...{\n          \"href\": \"type://Exceptions#peel(Throwable):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/util/Exceptions.html#peel(java.lang.Throwable)\"\n        }}>{`type://Exceptions#peel(Throwable)`}</a>{` method useful when the exception you are trying to\nhandle is wrapped by exceptions like `}<inlineCode parentName=\"p\">{`CompletionException`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`ExecutionException`}</inlineCode>{`:`}</p>\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-java\"\n        }}>{`import com.linecorp.armeria.common.Exceptions;\n\n@Override\npublic CompletionStage<RetryDecision> shouldRetry(ClientRequestContext ctx,\n                                                  @Nullable Throwable cause) {\n    if (cause != null) {\n        if (cause instanceof ResponseTimeoutException ||\n            cause instanceof UnprocessedRequestException) {\n            // The response timed out or the request has not been handled\n            // by the server.\n            return UnmodifiableFuture.completedFuture(backoff);\n        }\n\n        Throwable peeled = Exceptions.peel(cause);\n        if (peeled instanceof MyException) { ... }\n    }\n    ...\n}\n`}</code></pre>\n    </Tip>\n    <h2 {...{\n      \"id\": \"backoff\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#backoff\",\n        \"aria-label\": \"backoff permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><inlineCode parentName=\"h2\">{`Backoff`}</inlineCode></h2>\n    <p>{`You can use a `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` to determine the delay between attempts. Armeria provides `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{`\nimplementations which produce the following delays out of the box:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Fixed delay, created with `}<a parentName=\"li\" {...{\n          \"href\": \"type://Backoff#fixed(long):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html#fixed(long)\"\n        }}>{`type://Backoff#fixed(long)`}</a></li>\n      <li parentName=\"ul\">{`Random delay, created with `}<a parentName=\"li\" {...{\n          \"href\": \"type://Backoff#random(long,long):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html#random(long,long)\"\n        }}>{`type://Backoff#random(long,long)`}</a></li>\n      <li parentName=\"ul\">{`Exponential delay which is multiplied on each attempt, created with `}<a parentName=\"li\" {...{\n          \"href\": \"type://Backoff#exponential(long,long):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html#exponential(long,long)\"\n        }}>{`type://Backoff#exponential(long,long)`}</a></li>\n    </ul>\n    <p>{`Armeria provides `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff#ofDefault():https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html#ofDefault()\"\n      }}>{`type://Backoff#ofDefault()`}</a>{` that you might use by default. It is exactly the same as:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`Backoff.exponential(200   /* minDelayMillis */,\n                    10000 /* maxDelayMillis */,\n                    2.0   /* multiplier     */)\n       .withJitter(0.2 /* jitterRate */);\n`}</code></pre>\n    <p>{`The delay starts from `}<inlineCode parentName=\"p\">{`minDelayMillis`}</inlineCode>{` until it reaches `}<inlineCode parentName=\"p\">{`maxDelayMillis`}</inlineCode>{` multiplying by multiplier every\nretry. Please note that the `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff#withJitter(double):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html#withJitter(double)\"\n      }}>{`type://Backoff#withJitter(double)`}</a>{` will add jitter value to the calculated delay.`}</p>\n    <p>{`For more information, please refer to the API documentation of the\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/package-summary.html\"\n      }}>{`com.linecorp.armeria.client.retry`}</a>{` package.`}</p>\n    <h2 {...{\n      \"id\": \"maxtotalattempts-vs-per-backoff-maxattempts\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#maxtotalattempts-vs-per-backoff-maxattempts\",\n        \"aria-label\": \"maxtotalattempts vs per backoff maxattempts permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><inlineCode parentName=\"h2\">{`maxTotalAttempts`}</inlineCode>{` vs per-Backoff `}<inlineCode parentName=\"h2\">{`maxAttempts`}</inlineCode></h2>\n    <p>{`If you create a `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` using `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff#withMaxAttempts(int):https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html#withMaxAttempts(int)\"\n      }}>{`type://Backoff#withMaxAttempts(int)`}</a>{` in a `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryRule:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryRule.html\"\n      }}>{`type://RetryRule`}</a>{`,\nthe `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` which uses the `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryRule:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryRule.html\"\n      }}>{`type://RetryRule`}</a>{` will stop retrying when the number of\nattempts passed `}<inlineCode parentName=\"p\">{`maxAttempts`}</inlineCode>{`. However, if you have more than one `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` and return one after\nthe other continuously, it will keep retrying over and over again because the counter that\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` internally tracks is initialized every time the different `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` is\nreturned. To limit the number of attempts in a whole retry session, `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` limits\nthe maximum number of total attempts to 10 by default. You can change this value by specifying\n`}<inlineCode parentName=\"p\">{`maxTotalAttempts`}</inlineCode>{` when you build a `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`RetryingClient.newDecorator(rule, maxTotalAttempts);\n`}</code></pre>\n    <p>{`Or, you can override the default value of 10 using the JVM system property\n`}<inlineCode parentName=\"p\">{`-Dcom.linecorp.armeria.defaultMaxTotalAttempts=<integer>`}</inlineCode>{`.`}</p>\n    <p>{`Note that when a `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` stops due to the attempts limit, the client will get the last received\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://Response:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/Response.html\"\n      }}>{`type://Response`}</a>{` from the server.`}</p>\n    <h2 {...{\n      \"id\": \"per-attempt-timeout\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#per-attempt-timeout\",\n        \"aria-label\": \"per attempt timeout permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Per-attempt timeout`}</h2>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"type://ResponseTimeoutException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ResponseTimeoutException.html\"\n      }}>{`type://ResponseTimeoutException`}</a>{` can occur in two different situations while retrying. First, it occurs\nwhen the time of whole retry session has passed the time previously configured using:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`ClientBuilder.responseTimeoutMillis(millis);\n// or..\nClientRequestContext.setResponseTimeoutAfterMillis(millis);\n`}</code></pre>\n    <p>{`You cannot retry on this `}<a parentName=\"p\" {...{\n        \"href\": \"type://ResponseTimeoutException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ResponseTimeoutException.html\"\n      }}>{`type://ResponseTimeoutException`}</a>{`.\nSecond, it occurs when the time of individual attempt in retry has passed the time which is per-attempt timeout.\nYou can configure it when you create the decorator:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`RetryingClient.newDecorator(rule, maxTotalAttempts,\n                            responseTimeoutMillisForEachAttempt);\n`}</code></pre>\n    <p>{`You can retry on this `}<a parentName=\"p\" {...{\n        \"href\": \"type://ResponseTimeoutException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ResponseTimeoutException.html\"\n      }}>{`type://ResponseTimeoutException`}</a>{`.`}</p>\n    <p>{`For example, when making a retrying request to an unresponsive service\nwith `}<inlineCode parentName=\"p\">{`responseTimeoutMillis = 10,000`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`responseTimeoutMillisForEachAttempt = 3,000`}</inlineCode>{` and disabled\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{`, the first three attempts will be timed out by the per-attempt timeout (3,000ms).\nThe 4th one will be aborted after 1,000ms since the request session has reached at 10,000ms before\nit is timed out by the per-attempt timeout.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bob-svg\"\n      }}>{`0ms         3,000ms     6,000ms     9,000ms\n|           |           |           |\n+-----------+-----------+-----------+----+\n| Attempt 1 | Attempt 2 | Attempt 3 | A4 |\n+-----------+-----------+-----------+----+\n                                         |\n                                       10,000ms (ResponseTimeoutException)\n`}</code></pre>\n    <p>{`In the example above, every attempt is made before it is timed out because the `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` is disabled.\nHowever, what if a `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` is enabled and the moment of trying next attempt is after the point of\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://ResponseTimeoutException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/ResponseTimeoutException.html\"\n      }}>{`type://ResponseTimeoutException`}</a>{`? In such a case, the `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` does not schedule for the\nnext attempt, but finishes the retry session immediately with the last received `}<a parentName=\"p\" {...{\n        \"href\": \"type://Response:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/Response.html\"\n      }}>{`type://Response`}</a>{`.\nConsider the following example:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bob-svg\"\n      }}>{`0ms         3,000ms     6,000ms     9,000ms     12,000ms\n|           |           |           |           |\n+-----------+-----------+-----------+-----------+-----------------------+\n| Attempt 1 |           | Attempt 2 |           | Attempt 3 is not made |\n+-----------+-----------+-----------+----+------+-----------------------+\n                                    |    |\n                                    | 10,000ms (retry session deadline)\n                                    |\n                                stops retrying at this point\n`}</code></pre>\n    <p>{`Unlike the example above, the `}<a parentName=\"p\" {...{\n        \"href\": \"type://Backoff:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/Backoff.html\"\n      }}>{`type://Backoff`}</a>{` is enabled and it makes the `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` perform\nretries with 3-second delay. When the second attempt is finished at 9,000ms, the next attempt will be\nat 12,000ms exceeding the response timeout of 10,000ms.\nThe `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{`, at this point, stops retrying and finished the retry session with the last\nreceived `}<a parentName=\"p\" {...{\n        \"href\": \"type://Response:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/Response.html\"\n      }}>{`type://Response`}</a>{`, retrieved at 9,000ms from the attempt 2.`}</p>\n    <h2 {...{\n      \"id\": \"retryingclient-with-logging\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#retryingclient-with-logging\",\n        \"aria-label\": \"retryingclient with logging permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><inlineCode parentName=\"h2\">{`RetryingClient`}</inlineCode>{` with logging`}</h2>\n    <p>{`You can use `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` with `}<a parentName=\"p\" {...{\n        \"href\": \"type://LoggingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/logging/LoggingClient.html\"\n      }}>{`type://LoggingClient`}</a>{` to log. If you want to log all of the\nrequests and responses, decorate `}<a parentName=\"p\" {...{\n        \"href\": \"type://LoggingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/logging/LoggingClient.html\"\n      }}>{`type://LoggingClient`}</a>{` with `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{`. That is:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`RetryRule rule = RetryRule.failsafe();\nWebClient client = WebClient.builder(...)\n                            .decorator(LoggingClient.newDecorator())\n                            .decorator(RetryingClient.newDecorator(rule))\n                            .build();\n`}</code></pre>\n    <p>{`This will produce following logs when there are three attempts:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`Request: {startTime=..., length=..., duration=..., scheme=..., host=..., headers=[...]\nResponse: {startTime=..., length=..., duration=..., headers=[:status=500, ...]\nRequest: {startTime=..., ..., headers=[..., armeria-retry-count=1, ...]\nResponse: {startTime=..., length=..., duration=..., headers=[:status=500, ...]\nRequest: {startTime=..., ..., headers=[..., armeria-retry-count=2, ...]\nResponse: {startTime=..., length=..., duration=..., headers=[:status=200, ...]\n`}</code></pre>\n    <Tip mdxType=\"Tip\">\n      <p>{`Did you notice that the `}<inlineCode parentName=\"p\">{`armeria-retry-count`}</inlineCode>{` header is inserted from the second request?\n`}<a parentName=\"p\" {...{\n          \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n        }}>{`type://RetryingClient`}</a>{` inserts it to indicate the retry count of a request.\nThe server might use this value to reject excessive retries, etc.`}</p>\n    </Tip>\n    <p>{`If you want to log the first request and the last response, no matter if it's successful or not,\ndo the reverse:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.logging.LoggingClient;\n\nRetryRule rule = RetryRule.failsafe();\n// Note the order of decoration.\nWebClient client = WebClient.builder(...)\n                            .decorator(RetryingClient.newDecorator(rule))\n                            .decorator(LoggingClient.newDecorator())\n                            .build();\n`}</code></pre>\n    <p>{`This will produce single request and response log pair and the total number of attempts only, regardless\nhow many attempts are made:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`Request: {startTime=..., length=..., duration=..., scheme=..., host=..., headers=[...]\nResponse: {startTime=..., length=..., headers=[:status=200, ...]}, {totalAttempts=3}\n`}</code></pre>\n    <Tip mdxType=\"Tip\">\n      <p>{`Please refer to `}<a parentName=\"p\" {...{\n          \"href\": \"/docs/advanced-structured-logging#nested-log\"\n        }}>{`Nested log`}</a>{`,\nif you are curious about how this works internally.`}</p>\n    </Tip>\n    <h2 {...{\n      \"id\": \"retryingclient-with-circuit-breaker\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#retryingclient-with-circuit-breaker\",\n        \"aria-label\": \"retryingclient with circuit breaker permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><inlineCode parentName=\"h2\">{`RetryingClient`}</inlineCode>{` with circuit breaker`}</h2>\n    <p>{`You might want to use `}<a parentName=\"p\" {...{\n        \"href\": \"/docs/client-circuit-breaker\"\n      }}>{`Circuit breaker`}</a>{` with `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` using\n`}<a parentName=\"p\" {...{\n        \"href\": \"/docs/client-decorator\"\n      }}>{`Decorating a client`}</a>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.circuitbreaker.CircuitBreakerRule;\nimport com.linecorp.armeria.client.circuitbreaker.CircuitBreakerClientBuilder;\n\nCircuitBreakerRule cbRule = CircuitBreakerRule.onServerErrorStatus();\nRetryRule myRetryRule = RetryRule.builder()\n                                 ...\n                                 .build();\n\nWebClient client = WebClient.builder(...)\n                            .decorator(CircuitBreakerClient.builder(cbRule)\n                                                           .newDecorator())\n                            .decorator(RetryingClient.builder(myRetryRule)\n                                                     .newDecorator())\n                            .build();\n\nAggregatedHttpResponse res = client.execute(...).aggregate().join();\n`}</code></pre>\n    <p>{`This decorates `}<a parentName=\"p\" {...{\n        \"href\": \"type://CircuitBreakerClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/circuitbreaker/CircuitBreakerClient.html\"\n      }}>{`type://CircuitBreakerClient`}</a>{` with `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` so that the `}<a parentName=\"p\" {...{\n        \"href\": \"type://CircuitBreaker:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/circuitbreaker/CircuitBreaker.html\"\n      }}>{`type://CircuitBreaker`}</a>{`\njudges every request and retried request as successful or failed. If the failure rate exceeds a certain\nthreshold, it raises a `}<a parentName=\"p\" {...{\n        \"href\": \"type://FailFastException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/circuitbreaker/FailFastException.html\"\n      }}>{`type://FailFastException`}</a>{`. When using both clients, you need to build a custom\n`}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryRule:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryRule.html\"\n      }}>{`type://RetryRule`}</a>{` to handle this exception so that the `}<a parentName=\"p\" {...{\n        \"href\": \"type://RetryingClient:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/retry/RetryingClient.html\"\n      }}>{`type://RetryingClient`}</a>{` does not attempt\na retry unnecessarily when the circuit is open, e.g.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.circuitbreaker.FailFastException;\n\nRetryRule.of(RetryRule.builder()\n                      // The circuit is already open so stops retrying.\n                      .onException(FailFastException.class)\n                      .thenNoRetry(),\n             RetryRule.builder()\n                      .onException(ex -> ex instanceof ResponseTimeoutException ||\n                                         ex instanceof UnprocessedRequestException)\n                      .thenBackoff(),\n             // Implement the rest of your own rule.\n             ...);\n`}</code></pre>\n    <Tip mdxType=\"Tip\">\n      <p>{`You may want to allow retrying even on `}<a parentName=\"p\" {...{\n          \"href\": \"type://FailFastException:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/circuitbreaker/FailFastException.html\"\n        }}>{`type://FailFastException`}</a>{` when your endpoint is configured with\nclient-side load balancing because the next attempt might be sent to the next available endpoint.\nSee `}<a parentName=\"p\" {...{\n          \"href\": \"/docs/client-service-discovery\"\n        }}>{`Client-side load balancing and service discovery`}</a>{`\nfor more information.`}</p>\n    </Tip>\n    <h2 {...{\n      \"id\": \"see-also\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#see-also\",\n        \"aria-label\": \"see also permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`See also`}</h2>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"/docs/advanced-structured-logging\"\n        }}>{`Structured logging`}</a></li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      ","import { RouteComponentProps } from '@reach/router';\nimport { graphql, useStaticQuery } from 'gatsby';\nimport React from 'react';\n\nimport docsIndex from '../pages/docs/toc.json';\nimport MdxLayout from './mdx';\n\ninterface DocsLayoutProps extends RouteComponentProps {\n  pageContext: any;\n  pageTitle: string;\n}\n\nconst DocsLayout: React.FC<DocsLayoutProps> = (props) => {\n  const {\n    allMdx: { nodes: candidateMdxNodes },\n  } = useStaticQuery(graphql`\n    query {\n      allMdx(filter: { fileAbsolutePath: { glob: \"**/src/pages/docs/**\" } }) {\n        nodes {\n          tableOfContents(maxDepth: 1)\n          excerpt(pruneLength: 256, truncate: true)\n          parent {\n            ... on File {\n              sourceInstanceName\n              name\n            }\n          }\n        }\n      }\n    }\n  `);\n\n  return (\n    <MdxLayout\n      {...props}\n      candidateMdxNodes={candidateMdxNodes}\n      index={docsIndex}\n      prefix=\"docs\"\n      pageTitleSuffix=\"Armeria documentation\"\n    />\n  );\n};\n\nexport default DocsLayout;\n"],"names":["pageTitle","_frontmatter","makeShortcode","name","props","console","warn","mdx","Warning","Tip","layoutProps","MDXLayout","DefaultLayout","MDXContent","_ref","components","_objectWithoutPropertiesLoose","_excluded","Object","assign","mdxType","parentName","isMDXComponent","candidateMdxNodes","useStaticQuery","allMdx","nodes","React","MdxLayout","index","docsIndex","prefix","pageTitleSuffix"],"sourceRoot":""}